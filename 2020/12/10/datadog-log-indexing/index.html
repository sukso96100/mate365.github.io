<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="icon" href="/assets/favicon.ico">


    
    
    <title>Datadog에 Indexing 되는 로그에 대한 비용 최적화 하는 방법 · 클라우드메이트 기술 블로그</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    <link rel="stylesheet" href="/style.main.min.373d0dfe23fa7f8134900001851d28b67b96da7d25db133b343c8834bbbf7803.css" />

    
    <link rel="stylesheet" href="/style.custom.min.eadd2bef97a811408edcfb504139ad5539505b1d482c02880c6ff63e37e03afd.css" />
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146594086-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta property="og:title" content="Datadog에 Indexing 되는 로그에 대한 비용 최적화 하는 방법" />
<meta property="og:description" content="Log Management Indexing Log Management에서 Log Event는 매 월 말에 인덱스 된 총 로그 이벤트 수를 계산하여 발생합니다. (온디멘드 Retention 15일 기준 100만개 당 $2.5" />

<meta property="article:author" content="황준하"/>



<meta property="og:image" content="/2020/12/10/datadog-log-indexing/images/Add_Exclusion_Filter.png" />
</head>
<body class=" post-template ">

    <div class="site-wrapper">

<header class="site-header"><div class="outer site-nav-main">
    <div class="inner"><nav class="site-nav">
    <div class="site-nav-left">
        
            <a class="site-nav-logo" href="/">클라우드메이트 기술 블로그</a>
        
        
        <div class="site-nav-content">
            <ul class="nav" role="menu">
                
                <li class="nav-home" role="menuitem"><a href="/categories/hands-on">Hands On</a></li>
                
                <li class="nav-home" role="menuitem"><a href="/categories/tech">Tech</a></li>
                
                <li class="nav-home" role="menuitem"><a href="/categories/column">Column</a></li>
                
                <li class="nav-home" role="menuitem"><a href="/categories/mate-story">Mate Story</a></li>
                
                
                <li class="nav-home" role="menuitem"><a href="https://cloudmt.co.kr">cloudmt.co.kr</a></li>
                
            </ul>
        </div>
        
    </div>
</nav></div>
</div></header>

<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post ">

            <header class="post-full-header">
                
                    <section class="post-full-tags">
                    
                    
                        <a href="/categories/post"><b>Post</b></a>
                    
                    
                        <a href="/tags/datadog" style="margin-left: 10px">#Datadog</a>
                    
                        <a href="/tags/logs" style="margin-left: 10px">#Logs</a>
                    
                    </section>
                
                <h1 class="post-full-title">Datadog에 Indexing 되는 로그에 대한 비용 최적화 하는 방법</h1>

                

                <div class="post-full-byline">
                    <section class="post-full-byline-content">

                        <ul class="author-list">
  <li class="author-list-item">
        <div class="author-card">
            <div class="author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></div>
            <div class="author-info">
                <div class="author-info">
                    <h2>황준하</h2>
                </div>
            </div>
        </div>
        <a href="/authors/junha-hwang/" class="static-avatar author-profile-image">
            
                <div class="author-profile"
                    style="background: url(/authors/junha-hwang/%ed%99%a9%ec%a4%80%ed%95%98.jpg) no-repeat center; 
                    background-size: cover; width: 30px; height: 30px; 
                    border-radius: 100%; margin-bottom: 10px;">
                </div>
            
        </a>
    </li>
  

</ul>

                        <section class="post-full-byline-meta">
                            
                                
                                <h4 class="author-name">황준하</h4>
                                
                            
                            <div class="byline-meta-content">
                                <time class="byline-meta-date" datetime="2020-712-12">2020. 12. 10.</time>
                                <span class="byline-reading-time"><span class="bull">&bull;</span> 3 min read</span>
                            </div>
                        </section>

                    </section>


                </div>
            </header>

            
            <figure class="post-full-image">
                <img src="images/Add_Exclusion_Filter.png" alt="Datadog에 Indexing 되는 로그에 대한 비용 최적화 하는 방법" />
            </figure>
            

            <section class="post-full-content">
                <div class="post-content">
                    <h2 id="log-management-indexing">Log Management Indexing</h2>
<p>Log Management에서 Log Event는 매 월 말에 인덱스 된 총 로그 이벤트 수를 계산하여 발생합니다. (온디멘드 Retention 15일 기준 100만개 당 $2.55요금 청구)
따라서 요금을 줄이기 위해서는 인덱스 되는 로그의 양을 줄이는 방법이 최선입니다.
이를 위해 Retention 기간을 줄이는 방법과 Exclusion Filter를 이용하여 인덱스된 로그를 줄이는 방법이 있습니다.
추가로 Retention기간을 줄이는 경우 저장된 로그의 장기 저장을 위하여 별도 저장소로 아카이빙 하는 방법이 있습니다.</p>
<h2 id="log-management-index-비용">Log Management Index 비용</h2>
<p>● Set retention period 기간별 가격 (한 달, 백만 로그 이벤트 기준) – 2020.03.18일 기준
Billed Annually 기준, on-demand는 ( )</p>
<ul>
<li>3일: $1.06 (1.59)</li>
<li>7일: $1.27 (1.91)</li>
<li>15일: $1.70 (2.55)</li>
<li>30일: $2.50 (3.75)</li>
<li>45일: $3.30 (4.95)</li>
<li>60일: $4.10 (6.15)
<ul>
<li>Retention Period 변경은 Datadog Support에 변경 요청 진행해야 합니다.</li>
</ul>
</li>
</ul>
<h2 id="log-management-indexing-1">Log Management Indexing</h2>
<ol>
<li>Index Retention Period 줄이기 및 Daily quota 설정
Logs &gt; Configuration 에서 Indexes 탭으로 들어갑니다.</li>
</ol>
<p>[그림 1] Indexes 탭
<img src="images/Indexes_TAP.png" alt=""></p>
<p>인덱스가 없는 경우 New Index를 클릭하여 인덱스를 생성하고 인덱스가 있으면 위 [그림 1]과 같이 Edit을 클릭하면 [그림 2]와 같은 Index 수정 창이 표시됩니다.</p>
<p>[그림 2] Index 수정
<img src="images/Indexes_TAP2.png" alt=""></p>
<p>Define Index에서 Index를 처리할 로그에 대한 필터를 정의하고 Set retention period를 설정합니다.</p>
<p>(수정을 위해서는 Case Open 필요)</p>
<p>여기서 Set daily quota를 설정할 경우 [그림 3]과 같이 하루에 Index되는 로그의 제한(Exclusion 처리 후의 로그 양)을 설정할 수 있습니다.</p>
<ul>
<li>설정 시 한도를 초과하는 로그는 Index 되지 않으니 주의</li>
</ul>
<p>[그림 3] Set daily quota
<img src="images/Set_daily_quota.png" alt=""></p>
<p>모든 설정이 끝났다면 Save를 눌러주면 설정이 완료됩니다.</p>
<ol start="2">
<li>Exclusion Filter설정으로 Index 로그 줄이기
기존 Index에서 로깅이 필요하지 않은 로그(디버깅 로그 등)는 Exclusion Filter를 설정하여 Index되는 로그를 줄일 수 있습니다.</li>
</ol>
<p>[그림 4] Add an Exclusion Filter
<img src="images/Add_Exclusion_Filter.png" alt=""></p>
<p>[그림 4]와 같이 설정한 Index 아래의 Add an Exclusion Filter를 클릭합니다.</p>
<p>Define exclusion query에서 제외할 로그의 쿼리를 설정 후 Set exclusion percentage에서 해당 쿼리에 걸리는 로그에서 제외할 비중(퍼센트)을 설정하고 저장합니다.</p>
<p>[그림 5] Exclusion Filter 설정 창
<img src="images/Exclusion_Filter.png" alt=""></p>
<ol start="3">
<li>Index된 로그를 별도 저장소로 아카이브
비용 절약을 위해 Retention Period가 짧게 설정된 상태이므로 Log의 장기 저장을 위해 별도의 스토리지에 아카이브를 수행합니다.</li>
</ol>
<ul>
<li>여기서는 AWS S3로 설정 하였습니다.</li>
</ul>
<p>Logs &gt; Configuration 에서 Archives 탭으로 들어갑니다.</p>
<p>[그림 6] Archive 생성
<img src="images/Create_Archive.png" alt=""></p>
<p>[그림 6]와 같이 New archives를 클릭하면 아카이브 생성 창이 표시됩니다.</p>
<p>Archive 설정을 진행 합니다.</p>
<pre><code>1) Define which data to store에서 아카이브를 진행할 Log를 Filter 설정합니다.
2) Archive Type은 S3를 선택합니다.
3) Configure Bucket에서 AWS Account는 기존 AWS Integration시 사용한 Role을 선택합니다.
4) Log가 저장될 S3 Bucket과 Path를 설정합니다.
5) Archive Name을 설정 후 Save합니다.
</code></pre>
<p>[그림 7] Archive 설정
<img src="images/Archive_Config.png" alt=""></p>
<p>앞서 Archive 할 스토리지를 확인해보면 아래와 같이 정상적으로 Archive 된 로그를 확인 할 수 있습니다.
[그림 8] Archive 된 로그들
<img src="images/Archive_logs.png" alt=""></p>

                </div>
            </section>

        </article>

    </div>
</main>
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">

    <article class="read-next-card">
        <header class="read-next-card-header">
            <h3><span>More in</span> <a href="/categories/post">Post</a></h3>
        </header>
        <div class="read-next-card-content">
            <ul>
                
                <li>
                    <h4><a href="/2021/02/17/spot_by_netapp_%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/">Spot By NetApp 시작하기</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 17.</time> 
                                
                            </p>
                    </div>
                </li>
                
                <li>
                    <h4><a href="/2021/02/16/devtest-%ED%86%B5%ED%95%9C-devops-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0/">DevTest 통한 DevOps 구성하기</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 16.</time> 
                                
                            </p>
                    </div>
                </li>
                
                <li>
                    <h4><a href="/2021/02/16/%EC%A0%81%EC%A0%88%ED%95%9Cazure%EC%9A%B4%EC%98%81%EC%9C%BC%EB%A1%9C%EB%B9%84%EC%9A%A9%EC%9D%84%EC%B5%9C%EC%A0%81%ED%99%94%ED%95%98%EC%8B%9C%EB%A9%B4%EB%90%A9%EB%8B%88%EB%8B%A4/">적절한 Azure 운영으로 비용을 최적화하시면 됩니다.</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 16.</time> 
                                
                            </p>
                    </div>
                </li>
                
            </ul>
        </div>
    </article>
<article class="post-card post


 ">

        
            <a class="post-card-image-link" href="/2020/12/10/datadog-terraform/">
                <img class="post-card-image"src="/2020/12/10/datadog-terraform/images/Datadog-Monitor.png" alt="Datadog 알람을 Terraform으로 만들어 보자."/>
            </a>
        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="/2020/12/10/datadog-terraform/">
    
                <header class="post-card-header">
                    
                        
                        <div class="post-card-primary-tag">Post</div>
                    

                    <h2 class="post-card-title">Datadog 알람을 Terraform으로 만들어 보자.</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p>여러 클라우드 환경에서 이곳저곳 산재되어 있는 클라우드 리소스들을 통합적으로 모니터링이 가능하게 해주는 모니터링 솔루션인 Datadog을 알아 보자. Dat</p>
                </section>
    
            </a>

            
                
                
                <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"><b>황준하</b>님의 글 모두 보기</div>
                            <a href="/authors/junha-hwang/" class="static-avatar author-profile-image">
                            
                                <div class="author-profile"
                                    style="background: url(/authors/junha-hwang/%ed%99%a9%ec%a4%80%ed%95%98.jpg) no-repeat center; 
                                    background-size: cover; width: 30px; height: 30px; 
                                    border-radius: 100%; margin-bottom: 10px;">
                                </div>
                            
                            </a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span>황준하</span>
                        <span class="post-card-byline-date"><time datetime="2020-412-12">2020. 12. 10.</time>
                            <span class="bull">&bull;</span> 6 min read</span>
                    </div>
                </footer>
                
            
        </div>

</article>

            <article class="post-card post


 ">

        
            <a class="post-card-image-link" href="/2020/12/11/ngfw%EB%A1%9C-acme%EC%9D%98-%ED%8A%B8%EB%9E%9C%EC%A7%93-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%EB%B3%B4%ED%98%B8/">
                <img class="post-card-image"src="/2020/12/11/ngfw%EB%A1%9C-acme%EC%9D%98-%ED%8A%B8%EB%9E%9C%EC%A7%93-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%EB%B3%B4%ED%98%B8/images/2020-12-03_12-39-21.png" alt="AWS Re:Invent 2020 JAM으로 알아보는 NGFW로 네트워크 보안 강화하기"/>
            </a>
        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="/2020/12/11/ngfw%EB%A1%9C-acme%EC%9D%98-%ED%8A%B8%EB%9E%9C%EC%A7%93-%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4-%EB%B3%B4%ED%98%B8/">
    
                <header class="post-card-header">
                    
                        
                        <div class="post-card-primary-tag">Post</div>
                    

                    <h2 class="post-card-title">AWS Re:Invent 2020 JAM으로 알아보는 NGFW로 네트워크 보안 강화하기</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p>개요 올해 AWS 리인벤트는 COVID-19으로 인해 결국 온라인으로 진행되고있어요. 대개 이런 큰 이벤트에서 저는 주로 Hands On이나 직접 참여하는 활동을 즐기는데요</p>
                </section>
    
            </a>

            
                
                
                <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"><b>김성진</b>님의 글 모두 보기</div>
                            <a href="/authors/seongjin-kim/" class="static-avatar author-profile-image">
                            
                                <div class="author-profile"
                                    style="background: url(/authors/seongjin-kim/%ea%b9%80%ec%84%b1%ec%a7%84.jpg) no-repeat center; 
                                    background-size: cover; width: 30px; height: 30px; 
                                    border-radius: 100%; margin-bottom: 10px;">
                                </div>
                            
                            </a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span>김성진</span>
                        <span class="post-card-byline-date"><time datetime="2020-1212-12">2020. 12. 11.</time>
                            <span class="bull">&bull;</span> 6 min read</span>
                    </div>
                </footer>
                
            
        </div>

</article>
        </div>
    </div>
</aside>


        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="/">클라우드메이트 기술 블로그</a> &copy; 2020</section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    <a href="https://fb.me/cloudmatekr" target="_blank" rel="noopener">Facebook</a>
                    
                    <a href="https://github.com/mate365" target="_blank" rel="noopener">Github</a>
                    <a href="https://jonathanjanssens.com" target="_blank" rel="noopener" style="opacity: 0.5;">Hugo Casper3 by Jonathan Janssens</a>
                </nav>
            </div>
        </footer>

    </div>

</body>
</html>