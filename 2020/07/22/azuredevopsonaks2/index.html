<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="icon" href="/assets/favicon.ico">


    
    
    <title>Azure Devopsì™€ AKSë°°í¬ ê´€ë¦¬ 2í¸ - Docker ì´ë¯¸ì§€ì˜ AKS ë°°í¬ Â· í´ë¼ìš°ë“œë©”ì´íŠ¸ ê¸°ìˆ  ë¸”ë¡œê·¸ğŸ¦’</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    <link rel="stylesheet" href="/style.main.min.68a2444d3b5ba398d0abf4a55a7244effd6fcc47e53db58744c4113087ff12c5.css" />

    
    <link rel="stylesheet" href="/style.custom.min.1a8c14ada53575da722f1324d162d2599ea24f1551f5ccb93df4975f01aab3b7.css" />
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146594086-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta property="og:title" content="Azure Devopsì™€ AKSë°°í¬ ê´€ë¦¬ 2í¸ - Docker ì´ë¯¸ì§€ì˜ AKS ë°°í¬" />
<meta property="og:description" content="Azure Devops í”„ë¡œì íŠ¸ ìœ„ì¹˜ Azure Devopsì™€ AKSë°°í¬ ê´€ë¦¬ 2í¸ - Docker ì´ë¯¸ì§€ì˜ AKS ë°°í¬ ë¹Œë“œëœ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤. í†µí•©ëœ Devops íˆ´ì„ ì‚¬ìš©í•˜" />

<meta property="article:author" content="ë°•ì˜ì§„"/>



<meta property="og:image" content="/2020/07/22/azuredevopsonaks2/images/2020-07-10-13-55-58.png" />
</head>
<body class=" post-template ">

    <div class="site-wrapper">

<header class="site-header"><div class="outer site-nav-main">
    <div class="inner"><nav class="site-nav">
        <div class="site-nav-left">
            
                <a class="site-nav-logo" href="/">í´ë¼ìš°ë“œë©”ì´íŠ¸ ê¸°ìˆ  ë¸”ë¡œê·¸ğŸ¦’</a>
            
            <div class="site-nav-content">
                    <ul class="nav" role="menu">
                        
                        <li class="nav-home" role="menuitem"><a href="/categories/hands-on">Hands On</a></li>
                        
                        <li class="nav-home" role="menuitem"><a href="/categories/tech">Tech</a></li>
                        
                        <li class="nav-home" role="menuitem"><a href="/categories/column">Column</a></li>
                        
                        <li class="nav-home" role="menuitem"><a href="/categories/mate-story">Mate Story</a></li>
                        
                        
                        <li class="nav-home" role="menuitem"><a href=""></a></li>
                        
                    </ul>
            </div>
        </div>
    
  
</nav></div>
</div></header>

<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post ">

            <header class="post-full-header">
                
                    <section class="post-full-tags">
                    
                    
                        <a href="/categories/post"><b>Post</b></a>
                    
                    
                        <a href="/tags/azure-devops" class="tag">#Azure Devops</a>
                    
                        <a href="/tags/aks" class="tag">#AKS</a>
                    
                        <a href="/tags/devops" class="tag">#Devops</a>
                    
                        <a href="/tags/monitoring" class="tag">#Monitoring</a>
                    
                    </section>
                
                <h1 class="post-full-title">Azure Devopsì™€ AKSë°°í¬ ê´€ë¦¬ 2í¸ - Docker ì´ë¯¸ì§€ì˜ AKS ë°°í¬</h1>

                

                <div class="post-full-byline">
                    <section class="post-full-byline-content">

                        <ul class="author-list">
  <li class="author-list-item">
        <div class="author-card">
            <div class="author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></div>
            <div class="author-info">
                <div class="author-info">
                    <h2>ë°•ì˜ì§„</h2>
                </div>
            </div>
        </div>
        <a href="/authors/youngjin-park/" class="static-avatar author-profile-image">
            
                <div class="author-profile"
                    style="background: url(/authors/youngjin-park/%eb%b0%95%ec%98%81%ec%a7%84.jpg) no-repeat center; 
                    background-size: cover; width: 30px; height: 30px; 
                    border-radius: 100%; margin-bottom: 10px;">
                </div>
            
        </a>
    </li>
  

</ul>

                        <section class="post-full-byline-meta">
                            
                                
                                <h4 class="author-name">ë°•ì˜ì§„</h4>
                                
                            
                            <div class="byline-meta-content">
                                <time class="byline-meta-date" datetime="2020-127-07">2020. 07. 22.</time>
                                <span class="byline-reading-time"><span class="bull">&bull;</span> 6 min read</span>
                            </div>
                        </section>

                    </section>


                </div>
            </header>

            
            <figure class="post-full-image">
                <img src="images/2020-07-10-13-55-58.png" alt="Azure Devopsì™€ AKSë°°í¬ ê´€ë¦¬ 2í¸ - Docker ì´ë¯¸ì§€ì˜ AKS ë°°í¬" />
            </figure>
            

            <section class="post-full-content">
                <div class="post-content">
                    <p><a href="https://dev.azure.com/TestingProjectCM/DevopsEverything">Azure Devops í”„ë¡œì íŠ¸ ìœ„ì¹˜</a></p>
<h1 id="azure-devopsì™€-aksë°°í¬-ê´€ë¦¬-2í¸---docker-ì´ë¯¸ì§€ì˜-aks-ë°°í¬">Azure Devopsì™€ AKSë°°í¬ ê´€ë¦¬ 2í¸ - Docker ì´ë¯¸ì§€ì˜ AKS ë°°í¬</h1>
<p>ë¹Œë“œëœ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤. í†µí•©ëœ Devops íˆ´ì„ ì‚¬ìš©í•˜ê¸° ì „ì—ëŠ” Jenkinsì™€ ê°™ì€ ë¹Œë“œì„œë²„ì—ì„œ Ansibleê³¼ ê°™ì€ ë°°í¬íˆ´ë¡œ ì„œë²„ì— ë°°í¬í–ˆë‹¤. ê·¸ëŸ¬ê¸° ìœ„í•´ì„œëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ë”°ë¥¸ ë¹Œë“œí™˜ê²½ê³¼ ë°°í¬í™˜ê²½ì„ ì§ì ‘ ì…‹íŒ…ì´ í•„ìš”í–ˆë‹¤. í†µí•©ëœ Devopsì™€ Cloud ServiceëŠ” ì´ëŸ¬í•œ ì‘ì—…ì„ ìƒë‹¹íˆ ì¤„ì—¬ì¤€ë‹¤.</p>
<p>ì•„ë˜ëŠ” ì „ì²´ ì•„í‚¤í…ì³ì´ë‹¤. ìƒë‹¹íˆ í†µí•©ë˜ì–´ ìˆì–´ë³´ì¸ë‹¤.
<img src="images/%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90.png" alt=""></p>
<blockquote>
<p>ì—¬ëŸ¬ê°œì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬í˜„ì„ ìœ„í•´ Mysqlì„ ì§ì ‘ ë°°í¬í•´ë³´ì•˜ë‹¤.</p>
</blockquote>
<h1 id="2í¸-êµ¬í˜„-ëª©í‘œ">2í¸ êµ¬í˜„ ëª©í‘œ</h1>
<ol>
<li>Artifact ë°°í¬</li>
<li>Manifest íŒŒì¼ì„ í†µí•´ Kubernetesì— Applicationì„ ë°°í¬.</li>
<li>ëª¨ë‹ˆí„°ë§ Kubernetes Prometheus, Grafana ë°°í¬.</li>
<li>ARM templateìœ¼ë¡œ IaC êµ¬í˜„.</li>
</ol>
<h2 id="kubernetes-ë°°í¬">Kubernetes ë°°í¬</h2>
<p>1í¸ì—ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±ê¹Œì§€ êµ¬í˜„í–ˆë‹¤. ê·¸ë¦¬ê³  KubernetesëŠ” ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ê´€ë¦¬í•œë‹¤ê³  í–ˆë‹¤. ë”°ë¼ì„œ, ë¹Œë“œëœ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ Manifest ì‘ì„±ìœ¼ë¡œ Kubernetesì— ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•  ìˆ˜ ìˆë‹¤. ì‘ì„±ëœ Manifestë¥¼ ë°°í¬ íŒŒì´í”„ë¼ì¸ì—ì„œ ì‚¬ìš©í•˜ë„ë¡ Artifactì— ì €ì¥í•˜ê³ , Kubernetesì— ë°°í¬í•´ë³´ì.</p>
<blockquote>
<p><strong>Artifact?</strong>
ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì„ ì§„í–‰í•˜ë©´ì„œ ìƒì„±ë˜ëŠ” ë‹¤ì–‘í•œ ì‚°ì¶œë¬¼ì„ ì˜ë¯¸í•˜ë©°, ê°ì¢… ì„¤ê³„ë¬¸ì„œ, ì†ŒìŠ¤ì½”ë“œ, ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“± ì´ ìˆë‹¤.</p>
</blockquote>
<h3 id="kubernetes-ë¦¬ì†ŒìŠ¤-ìƒì„±">Kubernetes ë¦¬ì†ŒìŠ¤ ìƒì„±</h3>
<p>Azure Shellì—ì„œ AKSë¥¼ ìƒì„±í•˜ì.</p>
<pre><code>ACR_NAME=CMACR            # ACR ì´ë¦„ ë³€ìˆ˜ ì§€ì •
RESOURCE_GROUP=CM_Devops  # ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ ì§€ì •
REGION_NAME=koreacentral  # AKS ë¦¬ì „ ì§€ì •
AKS_NAME = aksclusterdevops

# Kubernetes ìµœì‹ ë²„ì „(preview ì œì™¸)
VERSION=$(az aks get-versions \
    --location $REGION_NAME \
    --query 'orchestrators[?!isPreview] | [-1].orchestratorVersion' \
    --output tsv)

# ì˜ˆì œí™˜ê²½ì—ì„œëŠ” 1ê°œì˜ ë…¸ë“œì™€ ê°€ì¥ ì‘ì€ ì‚¬ì´ì¦ˆì˜ VMì„ ì‚¬ìš©
# attack-acrì„ í†µí•´ 1í¸ì—ì„œ ë§Œë“  ACR ê¶Œí•œ ë¶€ì—¬
az aks create \
--resource-group $RESOURCE_GROUP \
--name $AKS_NAME \
--location $REGION_NAME \
--kubernetes-version $VERSION \
--generate-ssh-keys \
--node-vm-size Standard_B2s \
--node-count 1 \
--attach-acr $ACR_NAME

</code></pre><h3 id="manifest-ìƒì„±">Manifest ìƒì„±.</h3>
<p>Yamlì´ë‚˜ Jsoní˜•ì‹ìœ¼ë¡œ Kubernetesê°€ ìœ ì§€í•  ê°ì²´ì˜ ì›í•˜ëŠ” ìƒíƒœë¥¼ ì§€ì •í•œë‹¤. pod, replica set, configmap, secret, deployment ë“±ê³¼ ê°™ì€ ë¦¬ì†ŒìŠ¤ë¥¼ Manifestë¥¼ í†µí•´ ìƒì„±í•´ë³´ì. ì˜ˆì œ ManifestsëŠ” <a href="https://dev.azure.com/TestingProjectCM/_git/DevopsEverything?path=%2FManifests">&gt; Manifest ìœ„ì¹˜</a> ë¥¼ ì°¸ê³ í•˜ì.</p>
<p>ê¸°ì¡´ Docker imageë¥¼ Kubernetes í™˜ê²½ì— ì˜¬ë¦¬ê¸° ìœ„í•´ì„œëŠ” Deployment, Service, Config ë“±ì„ ê³ ë ¤í•´ì•¼í•œë‹¤. Config ë¶€ë¶„ì€ ì˜ˆë¥¼ë“¤ë©´ Database ì ‘ì†ì •ë³´, ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ Config, Docker pullì„ ìœ„í•œ ì¸ì¦ì •ë³´ ë“±ì´ ìˆë‹¤. ì´ëŸ¬í•œ ì •ë³´ëŠ” Secretì´ë‚˜ configmapì„ í†µí•´ ë°°í¬í•  ìˆ˜ ìˆë‹¤. ì´ ë¶€ë¶„ê¹Œì§€ Manifestì— í¬í•¨ ì‹œí‚¬ ì˜ˆì •ì´ë‹¤.</p>
<ul>
<li>
<p>Set Deployment <a href="https://dev.azure.com/TestingProjectCM/_git/DevopsEverything?path=%2FManifests%2Fapp-deployment.yaml">&gt; ìœ„ì¹˜</a></p>
<pre><code># MYSQL + PV  Deployment
apiVersion: &quot;apps/v1&quot; # for versions before 1.9.0 use apps/v1beta2
kind: Deployment
metadata:
name: simpleapp-mysql
labels:
    app: simpleapp
spec:
selector:
    matchLabels:
    app: simpleapp
    tier: mysql
strategy:
    type: Recreate
template:
    metadata:
    labels:
        app: simpleapp
        tier: mysql
    spec:
    containers:
    - image: mysql:5.7
        name: mysql
        args:
        - &quot;--ignore-db-dir=lost+found&quot;
        env:
        - name: MYSQL_DATABASE
        value: simpleapp
        - name: MYSQL_USER
        value: user
        - name: MYSQL_PASSWORD      # Secret ê°’ ì‚¬ìš©
        valueFrom:
            secretKeyRef:
            name: mysql-secret
            key: password
        - name: MYSQL_PORT
        value: &quot;3306&quot;
        - name: MYSQL_ROOT_PASSWORD     # Secret ê°’ ì‚¬ìš©
        valueFrom:
            secretKeyRef:
            name: mysql-secret
            key: password
        ports:
        - containerPort: 3306
        name: mysql
        volumeMounts:
        - name: mysql-persistent-storage
        mountPath: /var/lib/mysql
    volumes:
    - name: mysql-persistent-storage
        persistentVolumeClaim:
        claimName: mysql-pv-claim
  ---
  # ì˜ˆì œ ì–´í”Œë¦¬ì¼€ì´ì…˜ Deployment.
  apiVersion: &quot;apps/v1&quot; # for versions before 1.9.0 use apps/v1beta2
  kind: Deployment
  metadata:
  name: simpleapp
  labels:
      app: simpleapp
  spec:
  selector:
      matchLabels:
      app: simpleapp
      tier: frontend
  strategy:
      type: Recreate
  template:
      metadata:
      labels:
          app: simpleapp
          tier: frontend
      spec:
      containers:
      # ì˜ˆì œ ì–´í”Œë¦¬ì¼€ì´ì…˜ - Django
      - image: acrdevopse.azurecr.io/simple-app:latest
          name: simpleapp
          env:
          - name: DJANGO_SETTINGS_MODULE
          value: simpleapp.settings.production
          - name: MYSQL_DATABASE
          value: simpleapp
          - name: MYSQL_USER
          value: user
          - name: MYSQL_PASSWORD      # Secret ê°’ ì‚¬ìš©
          valueFrom:
              secretKeyRef:
              name: mysql-secret
              key: password
          - name: MYSQL_PORT
          value: &quot;3306&quot;
          - name: MYSQL_HOST
          value: simpleapp-mysql.simple-app
          - name: MYSQL_ROOT_PASSWORD     # Secret ê°’ ì‚¬ìš©
          valueFrom:
              secretKeyRef:
              name: mysql-secret
              key: password
          ports:
          - containerPort: 8000
          name: simpleapp
          volumeMounts: # djangoì˜ staticfilesë“¤ì„ nginxì™€ ê³µìœ 
          - name: staticfiles
          mountPath: /staticfiles
      # nginx
      - image: nginx
          name: simpleapp-nginx
          ports:
          - containerPort: 80
          volumeMounts: # djangoì˜ staticfilesë“¤ì„ nginxì™€ ê³µìœ 
          - name: staticfiles
          mountPath: /staticfiles
          - mountPath: /etc/nginx/conf.d
          name: nginx-conf
          readOnly: true
      volumes: # djangoì˜ staticfilesë“¤ì„ nginxì™€ ê³µìœ 
          - name: staticfiles
          emptyDir: {}
          - name: nginx-conf
          configMap:
              name: nginx-conf

</code></pre></li>
<li>
<p>Set Service <a href="https://dev.azure.com/TestingProjectCM/_git/DevopsEverything?path=%2FManifests%2Fapp-service.yaml">&gt; ìœ„ì¹˜</a></p>
<pre><code># ì˜ˆì œ ì–´í”Œë¦¬ì¼€ì´ì…˜ Service
# MYSQL
apiVersion: v1
kind: Service
metadata:
  name: simpleapp-mysql
  labels:
    app: simpleapp
spec:
  ports:
    - port: 3306
  selector:
    app: simpleapp
    tier: mysql
  clusterIP: None
--- # MYSQL PVC
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-pv-claim
  labels:
    app: simpleapp
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 20Gi
--- # Django ì–´í”Œë¦¬ì¼€ì´ì…˜ Service
apiVersion: v1
kind: Service
metadata:
  name: simpleapp
  labels:
    app: simpleapp
spec:
  ports:
    - port: 80
      targetPort: 80
  selector:
    app: simpleapp
    tier: frontend
  type: LoadBalancer
</code></pre></li>
<li>
<p>Set Configmap - nginx config <a href="https://dev.azure.com/TestingProjectCM/_git/DevopsEverything?path=%2FManifests%2Fdefault.conf">(default.conf)</a></p>
<pre><code>upstream website {
  server 127.0.0.1:8000;
}

server {

  location /static/ {
    autoindex on;
    alias /staticfiles/;
  }

  location / {
    proxy_pass http://website/;
    proxy_read_timeout 60;
    proxy_connect_timeout 60;
    proxy_send_timeout 60;
  }

  listen 80;
  server_name localhost;
}
</code></pre></li>
</ul>
<h2 id="artifact-ë°°í¬">Artifact ë°°í¬</h2>
<p>ì‘ì„±ëœ Manifestë¥¼ Release íŒŒì´í”„ë¼ì¸ì—ì„œ ì‚¬ìš©í•˜ê¸°ìœ„í•´ Artifactì— ì €ì¥í•´ì•¼í•œë‹¤. Build Pipelineì—ì„œ Gitì— ì €ì¥ëœ Manifestë¥¼ Artifactë¡œ ë³´ë‚´ëŠ” ì‘ì—…ì„ ì¶”ê°€í•œë‹¤. ì¤€ë¹„í•œ Manifestë¥¼ í”„ë¡œì íŠ¸ì˜ íŠ¹ì • ìœ„ì¹˜ì— ì—…ë¡œë“œ í›„ ì•„ë˜ì™€ ê°™ì´ Artifactë¡œ drop í•œë‹¤.<br>
<img src="images/2020-07-15-10-32-31.png" alt=""><br>
<img src="images/2020-07-15-10-33-13.png" alt=""></p>
<h2 id="release-íŒŒì´í”„ë¼ì¸">Release íŒŒì´í”„ë¼ì¸</h2>
<p>ë°°í¬í•œ AKS, Artifactë¥¼ í†µí•´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ Kubernetesí™˜ê²½ì— ì˜¬ë¦´ ì°¨ë¡€ì´ë‹¤. Release íŒŒì´í”„ë¼ì¸ì— ì•„ë˜ì™€ ê°™ì´ ì„¤ì •ì„ ë°°í¬í•˜ê¸°ë§Œ í•˜ë©´ëœë‹¤.</p>
<h3 id="apply-secret">apply secret</h3>
<p>ì–´í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ì‹œ <code>Keyvault</code>ì—ì„œ ê´€ë¦¬ë˜ëŠ” <code>í™˜ê²½ë³€ìˆ˜</code>ë“¤ì„ Kubernetes <code>Secret</code>ìœ¼ë¡œ ë°°í¬í•  ìˆ˜ ìˆë‹¤.<br>
<img src="images/2020-07-20-09-32-37.png" alt=""></p>
<h3 id="apply-imagepullsecret">apply imagepullsecret</h3>
<p>ACRì—ì„œ Pull í•˜ê¸°ìœ„í•œ ì¸ì¦ì„ ìœ„í•´ <code>Imagepullsecret</code>ì„ ì„¤ì •í•˜ì.<br>
<img src="images/2020-07-20-09-41-25.png" alt=""></p>
<h3 id="apply-configmap">apply configmap</h3>
<p><code>configmap</code>ì€ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” APIì˜¤ë¸Œì íŠ¸ì´ë‹¤. íŒŒì¼ì„ í†µí•œ ì €ì¥ì´ ê°€ëŠ¥í•˜ë‹¤.<br>
<img src="images/2020-07-20-09-45-23.png" alt=""></p>
<h3 id="apply-deployment">apply deployment</h3>
<p>Artifactì— ì €ì¥í•œ yamlì„ ê²½ë¡œë¡œ deploymentë¥¼ ì„¤ì •í•˜ê³ , Deployë¥¼ í•´ì¤€ë‹¤. <code>ImagePullSecret</code>ì€ ìœ„ì—ì„œ ì„¤ì •í•œ ê°’ ê·¸ëŒ€ë¡œ ì¨ì¤€ë‹¤.<br>
<img src="images/2020-07-20-09-47-14.png" alt=""></p>
<h3 id="apply-service">apply service</h3>
<p>ìœ„ì²˜ëŸ¼ Serviceë„ ì„¤ì •í•´ì¤€ë‹¤.
<img src="images/2020-07-20-09-57-15.png" alt=""></p>
<h3 id="ì„±ê³µ">ì„±ê³µ</h3>
<p>ë°°í¬ê°€ ì„±ê³µë˜ë©´ ì•„ë˜ì™€ ê°™ì´ <code>Azure shell</code>ì—ì„œ ëª…ë ¹ì–´ë¥¼ í†µí•´ ëª©ë¡ì„ ë³¼ ìˆ˜ìˆë‹¤. ì‹¤íŒ¨ì‹œ íŒŒì´í”„ë¼ì¸ì˜ ë¡œê·¸ë¥¼ ë³´ê³  ìŠˆíŒ…ì„ í•˜ë„ë¡í•˜ì.
<img src="images/2020-07-10-13-55-58.png" alt=""></p>
<h2 id="ëª¨ë‹ˆí„°ë§">ëª¨ë‹ˆí„°ë§</h2>
<h3 id="helm-chart">Helm Chart</h3>
<p><code>Helm</code>ì´ë€, ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ íŒ¨í‚¤ì§€ë¡œ í•´ì„œ ê´€ë¦¬í•´ì£¼ëŠ” ê²ƒìœ¼ë¡œ Pythonì˜ pip, Node.jsì˜ npmì˜ ì—­í• ë¡œ ë³´ë©´ëœë‹¤. <code>Helm Chart</code>ë€ íŒ¨í‚¤ì§€ í¬ë©§ìœ¼ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ì„¤ëª…í•˜ëŠ” íŒŒì¼ì˜ ì§‘í•©ì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.</p>
<p>ëª¨ë‹ˆí„°ë§ ë„êµ¬ë¡œì¨ Prometheusì™€ ëŒ€ì‹œë³´ë“œ Grafanaë¥¼ í•¨ê»˜ ë§ì´ ì‚¬ìš©í•˜ê³  ìˆë‹¤. Helm Chartì˜ ì‹¤ìŠµì„ í†µí•´ ëª¨ë‹ˆí„°ë§ êµ¬ì„±ì„ í•´ë³´ì•˜ë‹¤. Azure Shellì„ í†µí•´ ìš°ì„  ë°°í¬ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì•˜ìœ¼ë©°, ì¶”í›„ ë°°í¬ íŒŒì´í”„ë¼ì¸ì— ì¶”ê°€í•´ë³¼ ì˜ˆì •ì´ë‹¤.</p>
<ul>
<li>Prometheus ë°°í¬</li>
</ul>
<pre><code>kubectl create namespace monitoring

helm search repo prometheus

helm install monitoring stable/prometheus

</code></pre><ul>
<li>Grafana ë°°í¬</li>
</ul>
<pre><code>helm install prometheus stable/prometheus -n monitoring

helm install grafana stable/grafana --set persistence.enabled=true --set service.type=Loadbalancer --set persistence.size=8Gi --namespace monitoring

</code></pre><p>ìœ„ ëª…ë ¹ì–´ë¥¼ í†µí•´ ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ë°°í¬í•´ì£¼ì—ˆë‹¤. ê·¸ ë‹¤ìŒ <code>kubectl get service -n monitoring</code> ëª…ë ¹ì–´ë¥¼ í†µí•´ Grafana IPë¡œ ì ‘ì†í•´ì„œ, ëŒ€ì‹œë³´ë“œë¥¼ Import í•´ë³´ì.</p>
<p><img src="images/2020-07-21-15-01-00.png" alt=""></p>
<ul>
<li>ìœ„ ìŠ¤í¬ë¦°ìƒ·ì²˜ëŸ¼ ì ‘ì† í›„ ì™¼ìª½ì— ìˆëŠ” <code>+</code> ë©”ë‰´ì—ì„œ <code>Import</code>ë¡œ ë“¤ì–´ê°„ë‹¤.<br>
<img src="images/2020-07-21-15-02-29.png" alt=""></li>
<li>ìœ„ ì¹¸ì— <code>6417</code>ë¥¼ ì ìœ¼ë©´ ì•„ë˜ ìŠ¤í¬ë¦°ìƒ·ì²˜ëŸ¼ ë‚˜ì˜¨ë‹¤. <a href="https://grafana.com/grafana/dashboards/6417">Grafana Labs ì°¸ì¡°</a><br>
<img src="images/2020-07-21-15-03-21.png" alt=""></li>
<li>Importë¥¼ í•˜ê³  ìƒì„±í•œ ëŒ€ì‹œë³´ë“œë¥¼ ë„ìš°ë©´ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì˜¨ë‹¤.<br>
<img src="images/2020-07-21-15-04-42.png" alt=""></li>
</ul>
<p>ì´ë ‡ê²Œ ì‰¬ìš´ ì…‹íŒ…ìœ¼ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì¸í”„ë¼ì— ëŒ€í•´ ëª¨ë‹ˆí„°ë§ì„ í•  ìˆ˜ìˆê²Œ ë˜ì—ˆë‹¤. í•„ìš”í•œ Metricì„ ì„¤ì •í•˜ê³  alert ì„¤ì •ë„ ê°€ëŠ¥í•˜ë‹¤. ìì„¸í•œ ì‚¬ìš©ë°©ë²•ì€ ë„˜ì–´ê°€ê² ë‹¤.</p>
<h2 id="iac-infrastructure-as-code---azure-arm-template">IaC (Infrastructure as Code) - Azure ARM Template</h2>
<p>ì‚¬ì‹¤ ì´ í¬ìŠ¤íŒ…ì˜ ì˜ë„ëŠ”, ARM Templateìœ¼ë¡œ AKS, ACRì„ ìë™ ë°°í¬ í›„ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì˜¬ë ¤ë³´ê¸° ìœ„í•¨ì´ì—ˆë‹¤. í•˜ì§€ë§Œ êµ¬í˜„ ì¤‘ ë§ì€ ì–´ë ¤ì›€ì´ ì¡´ì¬í•´ ARM templateë¥¼ í†µí•œ ì ì ˆí•œ IaCë°©ë²•ì„ ì°¾ì§€ ëª»í–ˆë‹¤.</p>
<blockquote>
<p><strong>ARM Template?</strong><br>
Azure resourceë¥¼ ì½”ë“œë¡œì¨ ë°°í¬í•˜ê¸°ìœ„í•œ, ì¸í”„ë¼ ë° êµ¬ì„±ì„ ì •ì˜í•˜ëŠ” JSON íŒŒì¼ì´ë‹¤. ì´ëŸ¬í•œ ì„ ì–¸ì  ë°°í¬ë¥¼ í†µí•´ ì¼ê´€ì ì¸ ë¦¬ì†ŒìŠ¤ë¥¼ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ í•  ìˆ˜ ìˆë‹¤.</p>
</blockquote>
<ul>
<li>ARM template ë°°í¬ì‹œ, Azure Devopsì—ì„œ Connectionì„ ê°€ì§€ê³  ì˜¤ê¸°ê°€ í˜ë“¤ë‹¤.
<ul>
<li>Azure Devopsì—ì„œëŠ” Serviceê°„ connectionì„ í•œë²ˆì˜ ì„¤ì •ë§Œìœ¼ë¡œ ê´€ë¦¬í•´ì¤€ë‹¤.</li>
<li><img src="images/2020-07-20-10-10-23.png" alt=""></li>
</ul>
</li>
<li>ACRê³¼ì˜ Pullê¶Œí•œ ì—°ê²°
<ul>
<li><a href="https://github.com/MicrosoftDocs/azure-docs/issues/39508">Github Issue</a> ë¥¼ ë³´ë©´ ì´ ë°©ë²•ì€ ì „ì— ì´ë¯¸ ë…¼ì˜í–ˆë˜ í”ì ì„ ë³¼ ìˆ˜ìˆê³ , ë¶ˆê°€ëŠ¥í•˜ë‹¤ë¼ê³  ì í˜€ìˆë‹¤.</li>
<li>ê·¸ë˜ì„œ ë¹Œë“œíŒŒì´í”„ë¼ì¸ì—ì„œ ARM templateì´ ì•„ë‹Œ, Azure Cliì˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ë°°í¬í•´ë³´ì•˜ë‹¤. (Attachê°€ëŠ¥) í•˜ì§€ë§Œ, ìœ„ì—ì„œ ë§í•œ Service connectionë¬¸ì œê°€ ìˆì–´ ì–´ë ¤ì› ë‹¤.</li>
</ul>
</li>
</ul>
<h2 id="ì •ë¦¬">ì •ë¦¬</h2>
<p><code>Azure</code> ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ì¸í”„ë¼ë¥¼ êµ¬ì„±í•˜ê³  <code>Azure Devops</code>ë¥¼ í†µí•´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë„ì»¤í™”í•˜ê³  <code>Manifest</code>ë¡œ <code>Azure Kubernetes Service</code>ì— ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•´ ë³´ì•˜ê³  ë™ì‹œì— ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤ê¹Œì§€ êµ¬ì¶•í•´ë³´ì•˜ë‹¤. <code>Azure Devops</code>ì—ì„œ ì¸í”„ë¼ êµ¬ì„± ìë™í™”ê¹Œì§€ëŠ” ì–´ë ¤ìš´ì ì´ ìˆì—ˆì§€ë§Œ, ê°„ë‹¨í•œ ëª…ë ¹ì–´ë§Œìœ¼ë¡œ <code>Kubernetes Cluster</code> ìƒì„±ì´ ê°€ëŠ¥í–ˆë‹¤.</p>
<p>ì´ë ‡ê²Œ ë§Œë“¤ì–´ì§„ <code>Kubernetes Cluster</code>ìœ„ì— ì»¨í…Œì´ë„ˆí™”ëœ <code>ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤</code>ë“¤ì€ <code>Manifest</code>ë§Œìœ¼ë¡œ ë°°í¬í•˜ë©´ì„œ ê°œë°œì£¼ê¸°ê°€ ì—„ì²­ë‚˜ê²Œ í–¥ìƒë ê²ƒì„ ê¸°ëŒ€í• ìˆ˜ìˆë‹¤. ì´ˆê¸° ë„ì…ì€ í˜ë“¤ê² ì§€ë§Œ ì—„ì²­ë‚˜ê²Œ í° ì„œë¹„ìŠ¤ë¥¼ ê°œë°œí•˜ê¸°ì—ëŠ” <code>Kubernetes</code>ëŠ” ì •ë§ ë§¤ë ¥ì ì¸ê²ƒê°™ë‹¤.</p>

                </div>
            </section>

        </article>

    </div>
</main>
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">

    <article class="read-next-card">
        <header class="read-next-card-header">
            <h3><span>More in</span> <a href="/categories/post">Post</a></h3>
        </header>
        <div class="read-next-card-content">
            <ul>
                
                <li>
                    <h4><a href="/2021/02/17/spot_by_netapp_%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/">Spot By NetApp ì‹œì‘í•˜ê¸°</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 17.</time> 
                                
                            </p>
                    </div>
                </li>
                
                <li>
                    <h4><a href="/2021/02/16/devtest-%ED%86%B5%ED%95%9C-devops-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0/">DevTest í†µí•œ DevOps êµ¬ì„±í•˜ê¸°</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 16.</time> 
                                
                            </p>
                    </div>
                </li>
                
                <li>
                    <h4><a href="/2021/02/16/%EC%A0%81%EC%A0%88%ED%95%9Cazure%EC%9A%B4%EC%98%81%EC%9C%BC%EB%A1%9C%EB%B9%84%EC%9A%A9%EC%9D%84%EC%B5%9C%EC%A0%81%ED%99%94%ED%95%98%EC%8B%9C%EB%A9%B4%EB%90%A9%EB%8B%88%EB%8B%A4/">ì ì ˆí•œ Azure ìš´ì˜ìœ¼ë¡œ ë¹„ìš©ì„ ìµœì í™”í•˜ì‹œë©´ ë©ë‹ˆë‹¤.</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 16.</time> 
                                
                            </p>
                    </div>
                </li>
                
            </ul>
        </div>
    </article>
<article class="post-card post


 ">

        
            <a class="post-card-image-link" href="/2020/07/13/cloudontap-%EC%86%8C%EA%B0%9C/">
                <img class="post-card-image"src="/2020/07/13/cloudontap-%EC%86%8C%EA%B0%9C/images/Cloudmanager.png" alt="Cloud Volume Ontapìœ¼ë¡œ AWS-Azure data migration í•˜ê¸° (1í¸ CVO ì†Œê°œ)"/>
            </a>
        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="/2020/07/13/cloudontap-%EC%86%8C%EA%B0%9C/">
    
                <header class="post-card-header">
                    
                        
                        <div class="post-card-primary-tag">Post</div>
                    

                    <h2 class="post-card-title">Cloud Volume Ontapìœ¼ë¡œ AWS-Azure data migration í•˜ê¸° (1í¸ CVO ì†Œê°œ)</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p>Netappì˜ Cloud volume ontap ì„œë¹„ìŠ¤ë¥¼ êµ¬ì¶• ë° ì‚¬ìš©í•´ë´„ìœ¼ë¡œì„œ ëŠê¼ˆë˜ì ë“±ì„ ë¦¬ë·°í•˜ê³ ì í•©ë‹ˆë‹¤. CVOëŠ” ìŠ¤í† ë¦¬ì§€ë¡œ ìœ ëª…í•œ Netapp ì—ì„œ ì¶œì‹œí•œ ì œí’ˆìœ¼ë¡œ ìš´ìš© ë° ê´€ë¦¬ì˜ í¸ì˜ì„±</p>
                </section>
    
            </a>

            
                
                
                <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"><b>ì•ˆìš°ì˜</b>ë‹˜ì˜ ê¸€ ëª¨ë‘ ë³´ê¸°</div>
                            <a href="/authors/wooyeoung-ahn/" class="static-avatar author-profile-image">
                            
                                <div class="author-profile"
                                    style="background: url(/authors/wooyeoung-ahn/%ec%95%88%ec%9a%b0%ec%98%81.jpg) no-repeat center; 
                                    background-size: cover; width: 30px; height: 30px; 
                                    border-radius: 100%; margin-bottom: 10px;">
                                </div>
                            
                            </a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span>ì•ˆìš°ì˜</span>
                        <span class="post-card-byline-date"><time datetime="2020-127-07">2020. 07. 13.</time>
                            <span class="bull">&bull;</span> 2 min read</span>
                    </div>
                </footer>
                
            
        </div>

</article>

            <article class="post-card post


 ">

        
            <a class="post-card-image-link" href="/2020/07/27/azure-iot-architecture/">
                <img class="post-card-image"src="/2020/07/27/azure-iot-architecture/images/connectivity.png" alt="Azure IoT Architecture"/>
            </a>
        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="/2020/07/27/azure-iot-architecture/">
    
                <header class="post-card-header">
                    
                        
                        <div class="post-card-primary-tag">Post</div>
                    

                    <h2 class="post-card-title">Azure IoT Architecture</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p>IoTë€ ê°ì¢… ì‚¬ë¬¼ì— ì„¼ì„œì™€ í†µì‹  ê¸°ëŠ¥ì„ ë‚´ì¥í•˜ì—¬ ë¬´ì„  ë„¤íŠ¸ì›Œí¬ ìƒì—ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  ì „ì†¡í•˜ëŠ” ì‹œìŠ¤í…œì„ ë§í•©ë‹ˆë‹¤. Azure Architecture Centerì—ì„œ ì œì•ˆí•˜ëŠ” IoT ì°¸ì¡° ì•„í‚¤</p>
                </section>
    
            </a>

            
                
                
                <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"><b>ê¹€ì˜ˆë¦¼</b>ë‹˜ì˜ ê¸€ ëª¨ë‘ ë³´ê¸°</div>
                            <a href="/authors/yerim-kim/" class="static-avatar author-profile-image">
                            
                                <div class="author-profile"
                                    style="background: url(/authors/yerim-kim/%ea%b9%80%ec%98%88%eb%a6%bc.jpg) no-repeat center; 
                                    background-size: cover; width: 30px; height: 30px; 
                                    border-radius: 100%; margin-bottom: 10px;">
                                </div>
                            
                            </a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span>ê¹€ì˜ˆë¦¼</span>
                        <span class="post-card-byline-date"><time datetime="2020-127-07">2020. 07. 27.</time>
                            <span class="bull">&bull;</span> 6 min read</span>
                    </div>
                </footer>
                
            
        </div>

</article>
        </div>
    </div>
</aside>


        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright">
                    
                    <a href="https://cloudmt.co.kr" target="_blank" rel="noopener">
                    <img src="/assets/images/CMLOGO_WHITE.png" style="height: 40px"/>
                    </a>
                    
                    <a href="/">
                    
                    Â© 2019-Present CLOUDMATE Corp
                    
                    </a>
                </section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    <a href="https://fb.me/cloudmatekr" target="_blank" rel="noopener">Facebook</a>
                    
                    <a href="https://github.com/mate365" target="_blank" rel="noopener">Github</a>
                    <a href="https://jonathanjanssens.com" target="_blank" rel="noopener" style="opacity: 0.5;">Hugo Casper3 by Jonathan Janssens</a>
                </nav>
            </div>
        </footer>

    </div>

</body>
</html>