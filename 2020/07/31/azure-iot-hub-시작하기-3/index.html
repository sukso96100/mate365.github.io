<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="icon" href="/assets/favicon.ico">


    
    
    <title>Azure IoT Hub 시작하기 -3 · 클라우드메이트 기술 블로그</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    <link rel="stylesheet" href="/style.main.min.6cdac398fd59a1bab6a0cc9f69bdd198fb016e99aba91846eb921b373080c52d.css" />

    
    <link rel="stylesheet" href="/style.custom.min.4332dcd2c4522ce5ffc25d42db6ae83e95eebacb3e273328fa4d8f4de7dc791d.css" />
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146594086-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta property="og:title" content="Azure IoT Hub 시작하기 -3" />
<meta property="og:description" content="IoT Hub에서 서비스 버스로 라우팅을 설정하고, Logic Apps를 이용해 메일 알람을 설정하는 방법을 알아보겠습니다. 장비의 이상 탐지를 위해 IoT Hub에서 특정 값이" />

<meta property="article:author" content="김예림"/>



<meta property="og:image" content="/2020/07/31/azure-iot-hub-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-3/images/001.PNG" />
</head>
<body class=" post-template ">

    <div class="site-wrapper">

<header class="site-header"><div class="outer site-nav-main">
    <div class="inner"><nav class="site-nav">
    <div class="site-nav-left">
        
            <a class="site-nav-logo" target="_blank" href="https://cloudmt.co.kr"><img src="/assets/images/CMLOGO_WHITE.png" alt="클라우드메이트 기술 블로그" /></a>
        
        
        <div class="site-nav-content">
            <ul class="nav" role="menu">
                <li class="nav-home" role="menuitem"><a href="/"><b>🏠Tech Home</b></a></li>
                
                <li class="nav-home" role="menuitem"><a href="/categories/hands-on">Hands On</a></li>
                
                <li class="nav-home" role="menuitem"><a href="/categories/tech">Tech</a></li>
                
                <li class="nav-home" role="menuitem"><a href="/categories/column">Column</a></li>
                
                <li class="nav-home" role="menuitem"><a href="/categories/mate-story">Mate Story</a></li>
                
                
                <li class="nav-home" role="menuitem"><a href=""></a></li>
                
            </ul>
        </div>
        
    </div>
</nav></div>
</div></header>

<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post ">

            <header class="post-full-header">
                
                    <section class="post-full-tags">
                    
                    
                        <a href="/categories/post"><b>Post</b></a>
                    
                    
                        <a href="/tags/azure" style="margin-left: 10px">#Azure</a>
                    
                        <a href="/tags/iot" style="margin-left: 10px">#IoT</a>
                    
                        <a href="/tags/microsoft-azure" style="margin-left: 10px">#Microsoft Azure</a>
                    
                    </section>
                
                <h1 class="post-full-title">Azure IoT Hub 시작하기 -3</h1>

                

                <div class="post-full-byline">
                    <section class="post-full-byline-content">

                        <ul class="author-list">
  <li class="author-list-item">
        <div class="author-card">
            <div class="author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></div>
            <div class="author-info">
                <div class="author-info">
                    <h2>김예림</h2>
                </div>
            </div>
        </div>
        <a href="/authors/yerim-kim/" class="static-avatar author-profile-image">
            
                <div class="author-profile"
                    style="background: url(/authors/yerim-kim/%ea%b9%80%ec%98%88%eb%a6%bc.jpg) no-repeat center; 
                    background-size: cover; width: 30px; height: 30px; 
                    border-radius: 100%; margin-bottom: 10px;">
                </div>
            
        </a>
    </li>
  

</ul>

                        <section class="post-full-byline-meta">
                            
                                
                                <h4 class="author-name">김예림</h4>
                                
                            
                            <div class="byline-meta-content">
                                <time class="byline-meta-date" datetime="2020-127-07">2020. 07. 31.</time>
                                <span class="byline-reading-time"><span class="bull">&bull;</span> 3 min read</span>
                            </div>
                        </section>

                    </section>


                </div>
            </header>

            
            <figure class="post-full-image">
                <img src="images/001.PNG" alt="Azure IoT Hub 시작하기 -3" />
            </figure>
            

            <section class="post-full-content">
                <div class="post-content">
                    <p>IoT Hub에서 서비스 버스로 라우팅을 설정하고, Logic Apps를 이용해 메일 알람을 설정하는 방법을 알아보겠습니다.</p>
<p>장비의 이상 탐지를 위해 IoT Hub에서 특정 값이 있는 메시지를 Azure Service Bus의 큐로 전송합니다. Logic Apps를 통해 큐의 메시지를 3분마다 한 번 검색하여 큐에 내용이 있으면 메일로 해당 내용을 전송하도록 합니다.</p>
<p>목차는 다음과 같습니다.</p>
<ul>
<li>Azure Service Bus 네임스페이스 및 큐 생성</li>
<li>IoT Hub 사용자 엔드포인트 추가</li>
<li>Logic Apps 만들기</li>
<li>결과 확인</li>
</ul>
<h2 id="1-azure-service-bus-네임스페이스-및-큐-생성">1. Azure Service Bus 네임스페이스 및 큐 생성</h2>
<ol>
<li>
<p>Azure Portal에 Azure Service Bus를 검색하여 클릭합니다.</p>
</li>
<li>
<p><strong>+추가</strong>를 클릭하고 리소스 그룹, 네임스페이스 이름, 위치, 계층을 선택합니다. 실습에서는 기본 계층을 사용합니다.</p>
</li>
<li>
<p>생성한 네임스페이스의 메뉴에서 <strong>큐</strong>를 클릭하여 다음과 같이 생성합니다.</p>
</li>
</ol>
<p><img src="images/001.PNG" alt=""></p>
<h2 id="2-iot-hub-사용자-엔드포인트-추가">2. IoT Hub 사용자 엔드포인트 추가</h2>
<ol>
<li>
<p>IoT 허브 메뉴에서 <strong>메시지 라우팅</strong>을 클릭합니다.</p>
</li>
<li>
<p><strong>+엔드포인트 추가</strong>를 클릭하고 <strong>Service Bus 큐</strong>를 선택합니다.</p>
</li>
<li>
<p>엔드포인트 이름을 입력하고, 앞서 생성한 Service Bus 네임스페이스와 큐를 선택합니다.</p>
</li>
<li>
<p>경로 추가 창으로 돌아와 이름과 엔드포인트를 지정하고, 데이터 원본은 <strong>디바이스 원격 분석 메시지</strong>로 선택합니다.</p>
</li>
<li>
<p>라우팅 쿼리를 입력합니다. 기본 값을 사용하면 모든 메시지가 Service Bus 큐로 전송됩니다. 테스트를 위해 true로 설정하여 모든 메시지를 큐에 전송합니다.</p>
</li>
</ol>
<blockquote>
<p>아래와 같은 쿼리를 입력하면 레벨이 critical로 설정된 메시지만 Service Bus 큐로 전송됩니다. <img src="images/002.PNG" alt=""></p>
</blockquote>
<ol start="6">
<li>라우팅 결과를 확인합니다. <em>Azure IoT Hub 시작하기 -1</em> 에서 설정했던 엔드포인트인 <strong>스토리지 계정</strong>과 <strong>Azure Service Bus 큐</strong>에 메시지가 전송되는 것을 확인할 수 있습니다.</li>
</ol>
<p><img src="images/003.png" alt="스토리지 계정에 전송된 메시지"></p>
<p><img src="images/004.png" alt="Service Bus에 전송된 메시지"></p>
<h2 id="3-logic-apps-만들기">3. Logic Apps 만들기</h2>
<p>Logic Apps를 사용하여 Service Bus Queue에 메시지가 있는 경우, 해당 내용을 포함한 메일을 발송하도록 설정합니다.</p>
<ol>
<li>
<p>Azure Portal에서 Logic Apps를 검색하여 선택합니다.</p>
</li>
<li>
<p><strong>+추가</strong>를 클릭하여 리소스 그룹, 논리 앱 이름, 위치를 선택하고, <strong>Log Analytics</strong>는 끄기로 설정합니다.</p>
</li>
<li>
<p>Logic Apps가 생성되면 메뉴에서 <strong>논리 앱 디자이너</strong>를 클릭합니다.</p>
</li>
<li>
<p>트리거로 <em>Service Bus 큐에서 메시지가 수신되는 경우</em>를 선택합니다.</p>
</li>
<li>
<p><strong>계속</strong>을 클릭하여 Service Bus 큐를 선택하고, 큐를 확인할 시간 간격을 지정합니다. 기본적으로 3분마다 큐를 검색합니다.</p>
</li>
</ol>
<p><img src="images/005.png" alt="3분마다 큐 검사"></p>
<blockquote>
<p>참고 : 코드 보기를 클릭하여 frequency와 interval 변수 값을 수정할 수도 있습니다. <img src="images/006.png" alt=""></p>
</blockquote>
<ol start="6">
<li>
<p>단계를 추가하여 outlook 메일 보내기를 선택합니다. (메신저로 슬랙, 아웃룩, 지메일 등을 지원합니다)</p>
</li>
<li>
<p>outlook에 로그인하고 상세 설정을 합니다.</p>
</li>
<li>
<p>아래 그림과 같이 본문에 Service Bus 내용을 넣습니다.</p>
</li>
</ol>
<p><img src="images/007.png" alt=""></p>
<ol start="9">
<li>저장 후 결과를 확인합니다.</li>
</ol>
<blockquote>
<p>주의! : 앞서 큐에 모든 메시지를 저장하도록 설정한 경우, 메일 폭탄을 받을 수 있습니다. <img src="images/008.PNG" alt=""></p>
</blockquote>
<p>지금까지 3편의 포스팅에 걸쳐 IoT 허브를 생성하고, 다양한 엔드포인트로 데이터를 전송하는 방법을 알아보았습니다. <a href="https://tech.cloudmt.co.kr/2020/07/27/Azure-IoT-Architecture/">Azure IoT Architecture</a>에서 IoT 허브와 Azure의 다양한 PaaS 서비스를 연동한 아키텍처도 참고하시길 바랍니다.</p>

                </div>
            </section>

        </article>

    </div>
</main>
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">

    <article class="read-next-card">
        <header class="read-next-card-header">
            <h3><span>More in</span> <a href="/categories/post">Post</a></h3>
        </header>
        <div class="read-next-card-content">
            <ul>
                
                <li>
                    <h4><a href="/2021/02/17/spot_by_netapp_%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/">Spot By NetApp 시작하기</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 17.</time> 
                                
                            </p>
                    </div>
                </li>
                
                <li>
                    <h4><a href="/2021/02/16/devtest-%ED%86%B5%ED%95%9C-devops-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0/">DevTest 통한 DevOps 구성하기</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 16.</time> 
                                
                            </p>
                    </div>
                </li>
                
                <li>
                    <h4><a href="/2021/02/16/%EC%A0%81%EC%A0%88%ED%95%9Cazure%EC%9A%B4%EC%98%81%EC%9C%BC%EB%A1%9C%EB%B9%84%EC%9A%A9%EC%9D%84%EC%B5%9C%EC%A0%81%ED%99%94%ED%95%98%EC%8B%9C%EB%A9%B4%EB%90%A9%EB%8B%88%EB%8B%A4/">적절한 Azure 운영으로 비용을 최적화하시면 됩니다.</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 16.</time> 
                                
                            </p>
                    </div>
                </li>
                
            </ul>
        </div>
    </article>
<article class="post-card post


 ">

        
            <a class="post-card-image-link" href="/2020/07/30/azure-iot-hub-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/">
                <img class="post-card-image"src="/2020/07/30/azure-iot-hub-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/images/hubmsg.png" alt="Azure IoT Hub 시작하기 -1"/>
            </a>
        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="/2020/07/30/azure-iot-hub-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/">
    
                <header class="post-card-header">
                    
                        
                        <div class="post-card-primary-tag">Post</div>
                    

                    <h2 class="post-card-title">Azure IoT Hub 시작하기 -1</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p>지난 포스팅에서 Azure에서 제안하는 IoT 아키텍처를 소개하고, 각 구성 요소를 살펴보았습니다. 이번에는 예제 애플리케이션을 사용하여 원격 장치 데이터를 IoT 허</p>
                </section>
    
            </a>

            
                
                
                <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"><b>김예림</b>님의 글 모두 보기</div>
                            <a href="/authors/yerim-kim/" class="static-avatar author-profile-image">
                            
                                <div class="author-profile"
                                    style="background: url(/authors/yerim-kim/%ea%b9%80%ec%98%88%eb%a6%bc.jpg) no-repeat center; 
                                    background-size: cover; width: 30px; height: 30px; 
                                    border-radius: 100%; margin-bottom: 10px;">
                                </div>
                            
                            </a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span>김예림</span>
                        <span class="post-card-byline-date"><time datetime="2020-127-07">2020. 07. 30.</time>
                            <span class="bull">&bull;</span> 3 min read</span>
                    </div>
                </footer>
                
            
        </div>

</article>

            <article class="post-card post


 ">

        
            <a class="post-card-image-link" href="/2020/07/31/azure-iot-hub-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-2/">
                <img class="post-card-image"src="/2020/07/31/azure-iot-hub-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-2/images/1.png" alt="Azure IoT Hub 시작하기 -2"/>
            </a>
        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="/2020/07/31/azure-iot-hub-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-2/">
    
                <header class="post-card-header">
                    
                        
                        <div class="post-card-primary-tag">Post</div>
                    

                    <h2 class="post-card-title">Azure IoT Hub 시작하기 -2</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p>Stream Analytics job은 여러 원본으로부터 스트리밍 데이터를 동시에 분석 및 처리하도록 설계된 이벤트 처리 엔진입니다. Azure IoT Hub, Azure Event Hubs, Azure Blob Storage에서 원본 데이터를</p>
                </section>
    
            </a>

            
                
                
                <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"><b>김예림</b>님의 글 모두 보기</div>
                            <a href="/authors/yerim-kim/" class="static-avatar author-profile-image">
                            
                                <div class="author-profile"
                                    style="background: url(/authors/yerim-kim/%ea%b9%80%ec%98%88%eb%a6%bc.jpg) no-repeat center; 
                                    background-size: cover; width: 30px; height: 30px; 
                                    border-radius: 100%; margin-bottom: 10px;">
                                </div>
                            
                            </a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span>김예림</span>
                        <span class="post-card-byline-date"><time datetime="2020-127-07">2020. 07. 31.</time>
                            <span class="bull">&bull;</span> 2 min read</span>
                    </div>
                </footer>
                
            
        </div>

</article>
        </div>
    </div>
</aside>


        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright">
                    <a href="/">
                    
                    © 2019-Present CLOUDMATE Corp
                    
                    </a>
                </section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    <a href="https://fb.me/cloudmatekr" target="_blank" rel="noopener">Facebook</a>
                    
                    <a href="https://github.com/mate365" target="_blank" rel="noopener">Github</a>
                    <a href="https://jonathanjanssens.com" target="_blank" rel="noopener" style="opacity: 0.5;">Hugo Casper3 by Jonathan Janssens</a>
                </nav>
            </div>
        </footer>

    </div>

</body>
</html>