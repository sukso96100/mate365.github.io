<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="icon" href="/assets/favicon.ico">


    
    
    <title>Azure와 AWS간 VPN 연결하기 (Terraform) · 클라우드메이트 기술 블로그🦒</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    <link rel="stylesheet" href="/style.main.min.68a2444d3b5ba398d0abf4a55a7244effd6fcc47e53db58744c4113087ff12c5.css" />

    
    <link rel="stylesheet" href="/style.custom.min.1a8c14ada53575da722f1324d162d2599ea24f1551f5ccb93df4975f01aab3b7.css" />
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146594086-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<meta property="og:title" content="Azure와 AWS간 VPN 연결하기 (Terraform)" />
<meta property="og:description" content="Azure Virtual Network와 AWS VPC(Virtual Private Cloud)를 논리적으로 연동하고 싶은 분들이 계실 것입니다. Azure를 사용하면서 AWS도 함께 사용하고 싶고, 각각 Cloud 업체" />

<meta property="article:author" content="김세준"/>


</head>
<body class=" post-template ">

    <div class="site-wrapper">

<header class="site-header"><div class="outer site-nav-main">
    <div class="inner"><nav class="site-nav">
        <div class="site-nav-left">
            
                <a class="site-nav-logo" href="/">클라우드메이트 기술 블로그🦒</a>
            
            <div class="site-nav-content">
                    <ul class="nav" role="menu">
                        
                        <li class="nav-home" role="menuitem"><a href="/categories/hands-on">Hands On</a></li>
                        
                        <li class="nav-home" role="menuitem"><a href="/categories/tech">Tech</a></li>
                        
                        <li class="nav-home" role="menuitem"><a href="/categories/column">Column</a></li>
                        
                        <li class="nav-home" role="menuitem"><a href="/categories/mate-story">Mate Story</a></li>
                        
                        
                        <li class="nav-home" role="menuitem"><a href=""></a></li>
                        
                    </ul>
            </div>
        </div>
    
  
</nav></div>
</div></header>

<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post  no-image ">

            <header class="post-full-header">
                
                    <section class="post-full-tags">
                    
                    
                        <a href="/categories/post"><b>Post</b></a>
                    
                    
                        <a href="/tags/aws" class="tag">#AWS</a>
                    
                        <a href="/tags/azure" class="tag">#Azure</a>
                    
                        <a href="/tags/vpn" class="tag">#VPN</a>
                    
                        <a href="/tags/vpc" class="tag">#VPC</a>
                    
                        <a href="/tags/vnet" class="tag">#vNet</a>
                    
                        <a href="/tags/peering" class="tag">#Peering</a>
                    
                        <a href="/tags/terraform" class="tag">#Terraform</a>
                    
                        <a href="/tags/vgw" class="tag">#VGW</a>
                    
                        <a href="/tags/hol" class="tag">#HOL</a>
                    
                        <a href="/tags/hands-on-lab" class="tag">#Hands on Lab</a>
                    
                    </section>
                
                <h1 class="post-full-title">Azure와 AWS간 VPN 연결하기 (Terraform)</h1>

                

                <div class="post-full-byline">
                    <section class="post-full-byline-content">

                        <ul class="author-list">
  <li class="author-list-item">
        <div class="author-card">
            <div class="author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></div>
            <div class="author-info">
                <div class="author-info">
                    <h2>김세준</h2>
                </div>
            </div>
        </div>
        <a href="/authors/sejun-kim/" class="static-avatar author-profile-image">
            
                <div class="author-profile"
                    style="background: url(/authors/sejun-kim/%ea%b9%80%ec%84%b8%ec%a4%80.jpg) no-repeat center; 
                    background-size: cover; width: 30px; height: 30px; 
                    border-radius: 100%; margin-bottom: 10px;">
                </div>
            
        </a>
    </li>
  

</ul>

                        <section class="post-full-byline-meta">
                            
                                
                                <h4 class="author-name">김세준</h4>
                                
                            
                            <div class="byline-meta-content">
                                <time class="byline-meta-date" datetime="2019-128-08">2019. 08. 09.</time>
                                <span class="byline-reading-time"><span class="bull">&bull;</span> 3 min read</span>
                            </div>
                        </section>

                    </section>


                </div>
            </header>

            

            <section class="post-full-content">
                <div class="post-content">
                    <p>Azure Virtual Network와 AWS VPC(Virtual Private Cloud)를 논리적으로 연동하고 싶은 분들이 계실 것입니다. Azure를 사용하면서 AWS도 함께 사용하고 싶고, 각각 Cloud 업체의 장점을 활용하고 싶을 수도 있습니다. 그러한 경우 두 개의 Network를 논리적으로 연결하고 싶은 욕망이 생길 것이고 이를 관리하길 원하실 것입니다.</p>
<p>그러한 요구사항을 해소하기 위해 Azure Virtual Network Gateway와 AWS VPN Connection을 연결하여 Azure Virtual Network와 AWS VPC를 논리적으로 연결하는 방법에 대해 알아봅시다.</p>
<p><img src="images/Azure_to_AWS_VPN.PNG" alt="Azure_to_AWS_VPN"></p>
<h2 id="azure-virtual-network-gateway">Azure Virtual Network Gateway</h2>
<p>Azure Virtual Network Gateway(Network GW)는 IPSec VPN(Site-to-Site)과 SSL VPN(Point to Site)을 모두 지원합니다. 이 두 가지를 전부 구현해 주면서 관리형 서비스로 Azure에서 직접 관리하기 때문에 사용자는 리소스 모니터링만 하면 됩니다. Network GW는 여러가지를 지원하지만, SKU(성능)에 따라 지원하는 대역폭과 기능이 조금씩 다릅니다.</p>
<table>
<thead>
<tr>
<th>SKU</th>
<th>가격</th>
<th>Bandwidth</th>
<th>S2S</th>
<th>P2S</th>
<th>OpenSSL 지원</th>
</tr>
</thead>
<tbody>
<tr>
<td>Basic</td>
<td>₩40.49(대략) /시간</td>
<td>100 Mbps</td>
<td>최대 10</td>
<td>최대 128</td>
<td>No</td>
</tr>
<tr>
<td>VpnGw1</td>
<td>₩213.6835(대략) /시간</td>
<td>650 Mbps</td>
<td>최대 30*</td>
<td>최대 250**</td>
<td>Yes</td>
</tr>
<tr>
<td>VpnGw2</td>
<td>₩551.0785(대략) /시간</td>
<td>1 Gbps</td>
<td>최대 30*</td>
<td>최대 500**</td>
<td>Yes</td>
</tr>
<tr>
<td>VpnGw3</td>
<td>₩1,405.8125(대략) /시간</td>
<td>1.25 Gbps</td>
<td>최대 30*</td>
<td>최대 1,000**</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p>*11~30는 별도 과금</p>
<p>**129 이상은 별도 과금</p>
<p><a href="https://azure.microsoft.com/ko-kr/pricing/details/vpn-gateway/"><strong>참고 링크</strong></a></p>
<p>Network GW는 기본적으로 Active-Standby 구조를 가지며, 1대를 이용해도 이중화를 지원한다. 만약 Active-Active mode를 사용할 경우 Active-Active mode를 활성화 하면 되며 물리적으로 2개의 Instance가 생성되고 과금 역시 2배가 됩니다.</p>
<p>SSL VPN은 인증서를 직접 업로드하면 연결이 가능하며 OpenSSL, IKEv2, PPTP를 이용할 수 있습니다.</p>
<p>Network GW는 Connection이라는 것을 이용하여 VPN연결을 할 수 있으며 송신/수신을 담당합니다. connection을 만드려면 반대쪽 VPN장비의 Public IP를 이용하여 Local Network Gateway를 생성해야 합니다.</p>
<p>Network GW를 이용하여 Virtual Network(vNet)끼리 연결할 수 있으며, BGP Route를 이용하면 <a href="https://azure.microsoft.com/ko-kr/pricing/details/vpn-gateway/"><strong>vNet을 거쳐 다른 vNet과 통신을 지원</strong></a>합니다.</p>
<h2 id="aws-virtual-gateway">AWS Virtual Gateway</h2>
<p>AWS Virtual Gateway(VGW)는 하나의 VPC와 연결할 수 있습니다. 이 VGW는 하나 이상의 VPN Connection을 가질 수 있으며, 최대 1.25Gbps 대역폭을 지원합니다. SSL VPN(Point to Site)은 지원하지 않으며 별도의 성능을 보장하기 위한 정책은 없습니다. (SSL VPN은 별도의 서비스를 구성하셔야 합니다.)</p>
<p><a href="https://aws.amazon.com/ko/vpn/pricing/"><strong>참고 링크</strong></a></p>
<p>AWS VPN Connction은 기본적으로 2대의 Instance를 지원하고 있으며 반대쪽 VPN 장비의 설정에 따라 Acrive-Standby 또는 Active-Acrive mode를 사용할 수 있습니다.</p>
<p>AWS VPN Connction을 만드려면 반대쪽 VPN장비의 Public IP를 이용하여 Customer Gateway를 생성해야 하며, 과금은 VPN Connection 수 만큼 과금됩니다. 또한 AWS VPN Connction의 경우 수신측만 담당하고 있으며 VPN 장비에 DPD 설정이 되어있어야 합니다. 이유는 AWS VPN Connection의 경우 Tunnel에 Traffic이 10초간 흐르지 않을 셩우 Tunnel Down을 실행하기 때문에 DPD 설정이 되지 않는 장비라면 주기적으로 Tunnel에 트래픽을 흘려보내주는 설정을 해야 합니다. <a href="https://aws.amazon.com/ko/premiumsupport/knowledge-center/vpn-tunnel-instability-inactivity/"><strong>참고 링크</strong></a></p>
<h2 id="azure-to-aws-vpn-terraform">Azure to AWS VPN Terraform</h2>
<p>Azure와 AWS간 VPN연결을 하려면 Azure Portal과 AWS Console을 계속 왔다갔다 하면서 설정을 확인해야 합니다. 제가 몇번 해보니 너무 귀찮아서 배포자동화를 생각해 봤고 두 개의 Cloud업체에 Plugin을 제공하는 Terraform을 이용하여 구성해 봤습니다.</p>
<p><a href="https://github.com/kimsejun2000/Azure_to_AWS_VPN"><strong>여기</strong></a>에 자세한 설명을 해놨으니 참고하여 설정하면 좋을 것 같습니다.</p>

                </div>
            </section>

        </article>

    </div>
</main>
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">

    <article class="read-next-card">
        <header class="read-next-card-header">
            <h3><span>More in</span> <a href="/categories/post">Post</a></h3>
        </header>
        <div class="read-next-card-content">
            <ul>
                
                <li>
                    <h4><a href="/2021/02/17/spot_by_netapp_%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/">Spot By NetApp 시작하기</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 17.</time> 
                                
                            </p>
                    </div>
                </li>
                
                <li>
                    <h4><a href="/2021/02/16/devtest-%ED%86%B5%ED%95%9C-devops-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0/">DevTest 통한 DevOps 구성하기</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 16.</time> 
                                
                            </p>
                    </div>
                </li>
                
                <li>
                    <h4><a href="/2021/02/16/%EC%A0%81%EC%A0%88%ED%95%9Cazure%EC%9A%B4%EC%98%81%EC%9C%BC%EB%A1%9C%EB%B9%84%EC%9A%A9%EC%9D%84%EC%B5%9C%EC%A0%81%ED%99%94%ED%95%98%EC%8B%9C%EB%A9%B4%EB%90%A9%EB%8B%88%EB%8B%A4/">적절한 Azure 운영으로 비용을 최적화하시면 됩니다.</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 16.</time> 
                                
                            </p>
                    </div>
                </li>
                
            </ul>
        </div>
    </article>


            <article class="post-card post
 no-image
 ">

        
            <a class="post-card-image-link" href="/2019/11/28/insight2019_2/">
                <img class="post-card-image" src="/assets/images/default_post_cover.jpg" alt="NetApp Insight 2019 후기(2/2)"/>
            </a>
        
        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="/2019/11/28/insight2019_2/">
    
                <header class="post-card-header">
                    
                        
                        <div class="post-card-primary-tag">Post</div>
                    

                    <h2 class="post-card-title">NetApp Insight 2019 후기(2/2)</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p>Insight 2019 행사 2일차 행사 2일차엔 Keynote가 있어서 모든 행사가 9시에 시작합니다. 오전 내내 Keynote를 하는 일정입니다. 동영상과 행사 스케치는 NetApp Insight</p>
                </section>
    
            </a>

            
                
                
                <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"><b>김세준</b>님의 글 모두 보기</div>
                            <a href="/authors/sejun-kim/" class="static-avatar author-profile-image">
                            
                                <div class="author-profile"
                                    style="background: url(/authors/sejun-kim/%ea%b9%80%ec%84%b8%ec%a4%80.jpg) no-repeat center; 
                                    background-size: cover; width: 30px; height: 30px; 
                                    border-radius: 100%; margin-bottom: 10px;">
                                </div>
                            
                            </a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span>김세준</span>
                        <span class="post-card-byline-date"><time datetime="2019-1211-11">2019. 11. 28.</time>
                            <span class="bull">&bull;</span> 4 min read</span>
                    </div>
                </footer>
                
            
        </div>

</article>
        </div>
    </div>
</aside>


        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright">
                    
                    <a href="https://cloudmt.co.kr" target="_blank" rel="noopener">
                    <img src="/assets/images/CMLOGO_WHITE.png" style="height: 40px"/>
                    </a>
                    
                    <a href="/">
                    
                    © 2019-Present CLOUDMATE Corp
                    
                    </a>
                </section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    <a href="https://fb.me/cloudmatekr" target="_blank" rel="noopener">Facebook</a>
                    
                    <a href="https://github.com/mate365" target="_blank" rel="noopener">Github</a>
                    <a href="https://jonathanjanssens.com" target="_blank" rel="noopener" style="opacity: 0.5;">Hugo Casper3 by Jonathan Janssens</a>
                </nav>
            </div>
        </footer>

    </div>

</body>
</html>