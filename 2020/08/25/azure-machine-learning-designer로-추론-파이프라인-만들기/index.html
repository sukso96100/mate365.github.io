<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
    <title>데린이의 Azure Machine Learning Designer로 유추 파이프라인 만들기 · CLOUDMATE Tech</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    <link rel="stylesheet" href="/style.main.min.554810d3e908ec5f69f30304b1c888bab3fa7b13a34e38d3192cff1067df5bbb.css" />

    
    <link rel="stylesheet" href="/style.custom.min.d9d689b1fc51f8a08e7fb46f13628d42b1839a573d9e635ba77aec6b5a00a064.css" />

</head>
<body class=" post-template ">

    <div class="site-wrapper">

<header class="site-header"><div class="outer site-nav-main">
    <div class="inner"><nav class="site-nav">
    <div class="site-nav-left">
        
            <a class="site-nav-logo" href="">CLOUDMATE Tech</a>
        
        
        <div class="site-nav-content">
            <ul class="nav" role="menu">
                
                <li class="nav-home" role="menuitem"><a href="https://cloudmt.co.kr">cloudmt.co.kr</a></li>
                
            </ul>
        </div>
        
    </div>
</nav>

</div>
</div></header>

<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post  no-image ">

            <header class="post-full-header">

                
                    
                    <section class="post-full-tags">
                        <a href="/categories/post">Post</a>
                    </section>
                

                <h1 class="post-full-title">데린이의 Azure Machine Learning Designer로 유추 파이프라인 만들기</h1>

                

                <div class="post-full-byline">
                    <section class="post-full-byline-content">

                        

                        <section class="post-full-byline-meta">
                            
                            <div class="byline-meta-content">
                                <time class="byline-meta-date" datetime="2020-128-08">2020. 08. 25.</time>
                                <span class="byline-reading-time"><span class="bull">&bull;</span> 3 min read</span>
                            </div>
                        </section>

                    </section>


                </div>
            </header>

            

            <section class="post-full-content">
                <div class="post-content">
                    <p><a href="https://tech.cloudmt.co.kr/2020/08/24/Azure-Machine-Learning-Designer%EB%A1%9C-%ED%9A%8C%EA%B7%80-%EB%AA%A8%EB%8D%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0/">지난 포스팅</a>에 이어 유추 파이프라인을 만들고 배포하는 과정을 소개하겠습니다.</p>
<h3 id="1-유추-파이프라인-만들기">1. 유추 파이프라인 만들기</h3>
<p>모델을 훈련시키는 파이프라인을 만들고 실행한 후에는 훈련된 모델을 사용하여 새로운 데이터의 features를 바탕으로 label 값을 추론할 수 있는 두 번째 파이프라인이 필요합니다.</p>
<p>자동차에 대한 features를 바탕으로 가격 label을 학습한 모델을 이용하여 유추 파이프라인을 만들어보겠습니다. 추론에 사용할 데이터는 자동차 3대에 대한 새로운 데이터이며, 가격 column을 제외하고 입력합니다.</p>
<p>(1) 학습 파이프라인 우측 상단의 유추 파이프라인을 클릭하고, 실시간 유추 파이프라인을 선택합니다.</p>
<p><img src="images/infer.PNG" alt=""></p>
<p>아래 그림의 표시한 부분을 수정하여 유추 파이프라인을 완성합니다. 기존 Raw 데이터에는 가격 label이 포함되어 있으므로, 기존 모듈을 삭제하고 수동으로 데이터를 입력합니다.</p>
<p><img src="images/pipeline2.PNG" alt="만들 유추 파이프라인"></p>
<p>(2) <strong>Enter Data Manually</strong> 모듈을 검색하여 파이프라인 창에 추가하고, 데이터를 입력합니다.</p>
<p><img src="images/manuallydata.PNG" alt="데이터 입력"></p>
<pre><code class="language-csv" data-lang="csv">symboling,normalized-losses,make,fuel-type,aspiration,num-of-doors,body-style,drive-wheels,engine-location,wheel-base,length,width,height,curb-weight,engine-type,num-of-cylinders,engine-size,fuel-system,bore,stroke,compression-ratio,horsepower,peak-rpm,city-mpg,highway-mpg
3,NaN,alfa-romero,gas,std,two,convertible,rwd,front,88.6,168.8,64.1,48.8,2548,dohc,four,130,mpfi,3.47,2.68,9,111,5000,21,27
3,NaN,alfa-romero,gas,std,two,convertible,rwd,front,88.6,168.8,64.1,48.8,2548,dohc,four,130,mpfi,3.47,2.68,9,111,5000,21,27
1,NaN,alfa-romero,gas,std,two,hatchback,rwd,front,94.5,171.2,65.5,52.4,2823,ohcv,six,152,mpfi,2.68,3.47,9,154,5000,19,26
</code></pre><p>(3) 입력한 데이터 세트에는 <strong>price</strong> 필드가 없기 때문에 <strong>Select Columns in Dataset</strong> 모듈에서 <strong>price</strong> 필드를 제거합니다.</p>
<p>(4) 추론 파이프라인에는 모델을 평가하는 과정이 불필요하기 때문에 <strong>Evaluate Model</strong> 모듈을 제거합니다.</p>
<p>(5) <strong>Score Model</strong> 모듈의 결과로 나온 label 중 예측 결과만 선택하고 <strong>price</strong>로 이름을 변경하는 python 코드를 추가합니다. <strong>Execute Python Script</strong> 모듈을 추가하고, Python script를 다음으로 대체합니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">azureml_main</span>(dataframe1 <span style="color:#f92672">=</span> None, dataframe2 <span style="color:#f92672">=</span> None):

    scored_results <span style="color:#f92672">=</span> dataframe1[[<span style="color:#e6db74">&#39;Scored Labels&#39;</span>]]
    scored_results<span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;Scored Labels&#39;</span>:<span style="color:#e6db74">&#39;predicted_price&#39;</span>},
                        inplace<span style="color:#f92672">=</span>True)
    <span style="color:#66d9ef">return</span> scored_results
</code></pre></div><p>(6) <strong>제출</strong>을 클릭하여 파이프라인을 실행합니다. 완료되면 <strong>Execute Python Script</strong>를 마우스 우클릭하여 결과를 시각화합니다.</p>
<p><img src="images/result.PNG" alt="결과 시각화"></p>
<p>3개 자동차에 대한 예상 가격이 출력된 것을 확인할 수 있습니다.</p>
<h3 id="2-파이프라인-배포하기">2. 파이프라인 배포하기</h3>
<p>실시간 추론 파이프라인을 만들어서 테스트했습니다. 이제 파이프라인을 클라이언트 애플리케이션에 사용할 수 있도록 서비스로 배포해보겠습니다. 실시간 추론 파이프라인을 서비스로 배포하려면 AKS(Azure Kubernetes Service) 클러스터가 필요합니다. <a href="https://tech.cloudmt.co.kr/2020/08/24/Azure-Machine-Learning-Designer%EB%A1%9C-%ED%9A%8C%EA%B7%80-%EB%AA%A8%EB%8D%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0/">지난 포스팅</a>에서 만든 Inference Clusters를 사용하겠습니다.</p>
<p>(1) 실시간 유추 파이프라인 우측 상단의 <strong>배포</strong>를 클릭합니다.</p>
<p><img src="images/endpoint.PNG" alt="배포"></p>
<p>(2) 배포가 완료되면 엔드포인트 메뉴에서 생성된 엔드포인트를 선택합니다. REST 엔드포인트와 기본 키를 복사해둡니다.</p>
<p><img src="images/key.png" alt="엔드포인트"></p>
<p>(3) Notebooks 메뉴에서 <strong>auto_test.ipynb</strong> 파일을 생성합니다.</p>
<p><img src="images/filecreate.PNG" alt="notebook file create"></p>
<p>(4) 파일이 생성되면, 컴퓨팅 인스턴스가 지정되어 있고, 실행중인지 확인합니다.</p>
<p>(5) 다음 코드를 복사 붙여넣기 하고, 앞서 복사해둔 엔드포인트와 기본 키를 입력합니다. 코드는 price column을 제외한 차량 정보를 포함합니다.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">endpoint <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;YOUR_ENDPOINT&#39;</span> <span style="color:#75715e">#Replace with your endpoint</span>
key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;YOUR_KEY&#39;</span> <span style="color:#75715e">#Replace with your key</span>

<span style="color:#f92672">import</span> urllib.request
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> os

<span style="color:#75715e"># Prepare the input data</span>
data <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;Inputs&#34;</span>: {
        <span style="color:#e6db74">&#34;WebServiceInput0&#34;</span>:
        [
            {
                    <span style="color:#e6db74">&#39;symboling&#39;</span>: <span style="color:#ae81ff">3</span>,
                    <span style="color:#e6db74">&#39;normalized-losses&#39;</span>: None,
                    <span style="color:#e6db74">&#39;make&#39;</span>: <span style="color:#e6db74">&#34;alfa-romero&#34;</span>,
                    <span style="color:#e6db74">&#39;fuel-type&#39;</span>: <span style="color:#e6db74">&#34;gas&#34;</span>,
                    <span style="color:#e6db74">&#39;aspiration&#39;</span>: <span style="color:#e6db74">&#34;std&#34;</span>,
                    <span style="color:#e6db74">&#39;num-of-doors&#39;</span>: <span style="color:#e6db74">&#34;two&#34;</span>,
                    <span style="color:#e6db74">&#39;body-style&#39;</span>: <span style="color:#e6db74">&#34;convertible&#34;</span>,
                    <span style="color:#e6db74">&#39;drive-wheels&#39;</span>: <span style="color:#e6db74">&#34;rwd&#34;</span>,
                    <span style="color:#e6db74">&#39;engine-location&#39;</span>: <span style="color:#e6db74">&#34;front&#34;</span>,
                    <span style="color:#e6db74">&#39;wheel-base&#39;</span>: <span style="color:#ae81ff">88.6</span>,
                    <span style="color:#e6db74">&#39;length&#39;</span>: <span style="color:#ae81ff">168.8</span>,
                    <span style="color:#e6db74">&#39;width&#39;</span>: <span style="color:#ae81ff">64.1</span>,
                    <span style="color:#e6db74">&#39;height&#39;</span>: <span style="color:#ae81ff">48.8</span>,
                    <span style="color:#e6db74">&#39;curb-weight&#39;</span>: <span style="color:#ae81ff">2548</span>,
                    <span style="color:#e6db74">&#39;engine-type&#39;</span>: <span style="color:#e6db74">&#34;dohc&#34;</span>,
                    <span style="color:#e6db74">&#39;num-of-cylinders&#39;</span>: <span style="color:#e6db74">&#34;four&#34;</span>,
                    <span style="color:#e6db74">&#39;engine-size&#39;</span>: <span style="color:#ae81ff">130</span>,
                    <span style="color:#e6db74">&#39;fuel-system&#39;</span>: <span style="color:#e6db74">&#34;mpfi&#34;</span>,
                    <span style="color:#e6db74">&#39;bore&#39;</span>: <span style="color:#ae81ff">3.47</span>,
                    <span style="color:#e6db74">&#39;stroke&#39;</span>: <span style="color:#ae81ff">2.68</span>,
                    <span style="color:#e6db74">&#39;compression-ratio&#39;</span>: <span style="color:#ae81ff">9</span>,
                    <span style="color:#e6db74">&#39;horsepower&#39;</span>: <span style="color:#ae81ff">111</span>,
                    <span style="color:#e6db74">&#39;peak-rpm&#39;</span>: <span style="color:#ae81ff">5000</span>,
                    <span style="color:#e6db74">&#39;city-mpg&#39;</span>: <span style="color:#ae81ff">21</span>,
                    <span style="color:#e6db74">&#39;highway-mpg&#39;</span>: <span style="color:#ae81ff">27</span>,
            },
        ],
    },
    <span style="color:#e6db74">&#34;GlobalParameters&#34;</span>:  {
    }
}
body <span style="color:#f92672">=</span> str<span style="color:#f92672">.</span>encode(json<span style="color:#f92672">.</span>dumps(data))
headers <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;Content-Type&#39;</span>:<span style="color:#e6db74">&#39;application/json&#39;</span>, <span style="color:#e6db74">&#39;Authorization&#39;</span>:(<span style="color:#e6db74">&#39;Bearer &#39;</span><span style="color:#f92672">+</span> key)}
req <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>Request(endpoint, body, headers)

<span style="color:#66d9ef">try</span>:
    response <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(req)
    result <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>read()
    json_result <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(result)
    y <span style="color:#f92672">=</span> json_result[<span style="color:#e6db74">&#34;Results&#34;</span>][<span style="color:#e6db74">&#34;WebServiceOutput0&#34;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#34;predicted_price&#34;</span>]
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Predicted price: {:.2f}&#39;</span><span style="color:#f92672">.</span>format(y))

<span style="color:#66d9ef">except</span> urllib<span style="color:#f92672">.</span>error<span style="color:#f92672">.</span>HTTPError <span style="color:#66d9ef">as</span> error:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;The request failed with status code: &#34;</span> <span style="color:#f92672">+</span> str(error<span style="color:#f92672">.</span>code))

    <span style="color:#75715e"># Print the headers to help debug the error</span>
    <span style="color:#66d9ef">print</span>(error<span style="color:#f92672">.</span>info())
    <span style="color:#66d9ef">print</span>(json<span style="color:#f92672">.</span>loads(error<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf8&#34;</span>, <span style="color:#e6db74">&#39;ignore&#39;</span>)))
</code></pre></div><p>(6) 저장하고 실행한 후, 결과를 확인합니다.</p>
<p><img src="images/result2.png" alt="결과로 출력된 가격 label"></p>
<p>(7) 사용을 마친 컴퓨팅 인스턴스와 유추 클러스터는 중지하거나 삭제하여 불필요한 과금을 방지합니다.</p>
<p>지금까지 Azure Machine Learning designer를 사용하여 코드 없이 회귀 모델을 만들어 학습시키고 유추 파이프라인을 만드는 실습을 해보았습니다. 파이프라인을 이용하면 데이터를 정제하고 정규화하는 과정을 중간 결과물로 확인할 수 있고, 데이터의 흐름을 시각화할 수 있습니다.</p>

                </div>
            </section>

        </article>

    </div>
</main>
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">

    <article class="read-next-card">
        <header class="read-next-card-header">
            <h3><span>More in</span> <a href="/categories/post">Post</a></h3>
        </header>
        <div class="read-next-card-content">
            <ul>
                
                <li>
                    <h4><a href="/2021/02/17/spot_by_netapp_%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/">Spot By NetApp 시작하기</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 17.</time> 
                                
                            </p>
                    </div>
                </li>
                
                <li>
                    <h4><a href="/2021/02/16/devtest-%ED%86%B5%ED%95%9C-devops-%EA%B5%AC%EC%84%B1%ED%95%98%EA%B8%B0/">DevTest 통한 DevOps 구성하기</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 16.</time> 
                                
                            </p>
                    </div>
                </li>
                
                <li>
                    <h4><a href="/2021/02/16/%EC%A0%81%EC%A0%88%ED%95%9Cazure%EC%9A%B4%EC%98%81%EC%9C%BC%EB%A1%9C%EB%B9%84%EC%9A%A9%EC%9D%84%EC%B5%9C%EC%A0%81%ED%99%94%ED%95%98%EC%8B%9C%EB%A9%B4%EB%90%A9%EB%8B%88%EB%8B%A4/">적절한 Azure 운영으로 비용을 최적화하시면 됩니다.</a></h4>
                    <div class="read-next-card-meta">
                            <p><time datetime="2021-122-02">2021. 02. 16.</time> 
                                
                            </p>
                    </div>
                </li>
                
            </ul>
        </div>
    </article>
<article class="post-card post
 no-image
 ">

        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="/2020/08/24/azure-machine-learning-designer%EB%A1%9C-%ED%9A%8C%EA%B7%80-%EB%AA%A8%EB%8D%B8-%EB%A7%8C%EB%93%A4%EA%B8%B0/">
    
                <header class="post-card-header">
                    
                        
                        <div class="post-card-primary-tag">Post</div>
                    

                    <h2 class="post-card-title">데린이의 Azure Machine Learning Designer로 회귀 모델 만들기</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p>이번 포스팅은 Azure Machine Learning 실습 자료를 바탕으로 작성하였습니다. 해당 모듈은 Azure Machine Learning을 사용하여 코드 없이 예측 모델 만들기 실습의 두 번째 모듈입니다. 1.</p>
                </section>
    
            </a>

            <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"></div>
                            <a href="#" class="static-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span></span>
                        <span class="post-card-byline-date"><time datetime="2020-128-08">2020. 08. 24.</time>
                            <span class="bull">&bull;</span> 6 min read</span>
                    </div>
                </footer>
    
        </div>

</article>

            <article class="post-card post
 no-image
 ">

        
    
        <div class="post-card-content">
    
            <a class="post-card-content-link" href="/2020/10/15/azure_devtestlab%EC%9C%BC%EB%A1%9C_%EB%8C%80%EB%9F%89_%EB%B0%B0%ED%8F%AC_%ED%95%B4%EA%B2%B0%ED%95%98%EA%B8%B0/">
    
                <header class="post-card-header">
                    
                        
                        <div class="post-card-primary-tag">Post</div>
                    

                    <h2 class="post-card-title">해커톤 참가자들에게 VM 77개 배포하기- DevTest Labs 사용기</h2>
                </header>
    
                <section class="post-card-excerpt">
                    <p>171명 77팀을 대상으로 온라인 해커톤이 진행됐다. 우리 회사에서는 VSCodeSpace 기반 공동 개발 환경을 안내하고, 팀별 프로덕트 배포 및 데이터베이스 설치를 위한 VM을 제</p>
                </section>
    
            </a>

            <footer class="post-card-meta">
                    <ul class="author-list">
                        <li class="author-list-item">
                            <div class="author-name-tooltip"></div>
                            <a href="#" class="static-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></a>
                        </li>
                    </ul>
                    <div class="post-card-byline-content">
                        <span></span>
                        <span class="post-card-byline-date"><time datetime="2020-1210-10">2020. 10. 15.</time>
                            <span class="bull">&bull;</span> 6 min read</span>
                    </div>
                </footer>
    
        </div>

</article>
        </div>
    </div>
</aside>


        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="">CLOUDMATE Tech</a> &copy; 2020</section>
                <nav class="site-footer-nav">
                    <a href="">Latest Posts</a>
                    <a href="https://fb.me/cloudmatekr" target="_blank" rel="noopener">Facebook</a>
                    
                    <a href="https://github.com/mate365" target="_blank" rel="noopener">Github</a>
                    <a href="https://jonathanjanssens.com" target="_blank" rel="noopener" style="opacity: 0.5;">Hugo Casper3 by Jonathan Janssens</a>
                </nav>
            </div>
        </footer>

    </div>

</body>
</html>